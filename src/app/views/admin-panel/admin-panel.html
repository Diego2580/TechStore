<div class="container py-5">
	<h1 class="text-center mb-4">Panel de Control - Tech Store Pro</h1>

	<!-- SECCIÃ“N NOSOTROS -->
	<div class="card shadow border-0 p-4 mb-5 bg-light">
		<h2 class="h4 text-primary mb-3">ğŸ“– Gestionar SecciÃ³n "Nosotros"</h2>
		
		@if (cargandoNosotros) {
			<div class="text-center py-3">
				<div class="spinner-border spinner-border-sm text-primary" role="status">
					<span class="visually-hidden">Cargando...</span>
				</div>
				<p class="text-muted mt-2 small">Cargando informaciÃ³n...</p>
			</div>
		} @else if (!editandoNosotros && nosotros && nosotros.titulos_descripciones && nosotros.titulos_descripciones.length > 0) {
			<div class="alert alert-info">
				<strong>Imagen:</strong> <img [src]="nosotros.imagen" style="max-height: 80px; border-radius: 3px; margin: 5px 0;" [alt]="'Imagen de nosotros'" onerror="this.style.display='none'" />
				<div class="mt-3">
					<strong>TÃ­tulos y Descripciones:</strong>
					<ul class="mt-2">
						@for (item of nosotros.titulos_descripciones; track $index) {
							<li class="mb-3 p-2 bg-white rounded border">
								<strong>{{ item.titulo }}</strong>
								<p class="text-muted mb-0 small">{{ item.descripcion.substring(0, 100) }}...</p>
							</li>
						}
					</ul>
				</div>
			</div>
			<button type="button" class="btn btn-warning" (click)="editarNosotros()">âœï¸ Editar</button>
		} @else if (editandoNosotros && nosotros) {
			<!-- FORMULARIO DE EDICIÃ“N -->
			<form (ngSubmit)="guardarNosotros()" class="mt-3">
				<div class="card bg-light p-3 mb-3">
					<h5 class="card-title fw-bold mb-3">ğŸ–¼ï¸ Imagen Principal</h5>
					
					<div class="mb-3">
						<label for="imagen-nosotros-url" class="form-label fw-bold">URL de Imagen</label>
						<input id="imagen-nosotros-url" type="text" class="form-control" placeholder="https://..." [(ngModel)]="formularioNosotros.imagen" name="imagen" aria-label="URL de imagen" />
					</div>

					<div class="mb-3">
						<label for="imagen-nosotros-file" class="form-label fw-bold">O Cargar Imagen</label>
						<input id="imagen-nosotros-file" type="file" class="form-control" accept="image/*" (change)="onImageSelected($event, 'nosotros')" aria-label="Cargar imagen" />
						<small class="text-muted d-block mt-2">Formatos: JPG, PNG, GIF (mÃ¡x. 5MB)</small>
					</div>

					@if (formularioNosotros.imagen) {
						<div class="mt-3">
							<small class="text-muted d-block mb-2"><strong>PrevisualizaciÃ³n:</strong></small>
							<img [src]="formularioNosotros.imagen" 
								 style="max-height: 200px; border-radius: 5px; margin-top: 5px; border: 2px solid #ccc;" 
								 alt="Preview" 
								 onerror="this.style.display='none'" 
								 class="img-thumbnail" />
						</div>
					}
				</div>

				<hr />

				<h5 class="text-secondary">Agregar TÃ­tulos y Descripciones</h5>
				
				<div class="mb-3">
					<label for="titulo-input" class="form-label fw-bold">TÃ­tulo</label>
					<input id="titulo-input" type="text" class="form-control" [(ngModel)]="formularioNosotros.titulo_temp" name="titulo_temp" placeholder="Ej: Nuestra MisiÃ³n" />
				</div>

				<div class="mb-3">
					<label for="descripcion-input" class="form-label fw-bold">DescripciÃ³n</label>
					<textarea id="descripcion-input" class="form-control" [(ngModel)]="formularioNosotros.descripcion_temp" name="descripcion_temp" placeholder="Escribe la descripciÃ³n aquÃ­..." rows="4"></textarea>
				</div>

				<button type="button" class="btn btn-info mb-3" (click)="agregarTituloDescripcion()">â• Agregar TÃ­tulo/DescripciÃ³n</button>

				@if (nosotros.titulos_descripciones && nosotros.titulos_descripciones.length > 0) {
					<div class="list-group mb-3">
						@for (item of nosotros.titulos_descripciones; track $index) {
							<div class="list-group-item d-flex justify-content-between align-items-start">
								<div class="flex-grow-1">
									<h6 class="mb-1">{{ item.titulo }}</h6>
									<p class="mb-0 text-muted small">{{ item.descripcion.substring(0, 80) }}...</p>
								</div>
								<div class="btn-group ms-2">
									<button type="button" class="btn btn-sm btn-outline-primary" (click)="prepararEdicionTituloDescripcion($index)">âœï¸ Editar</button>
									<button type="button" class="btn btn-sm btn-outline-danger" (click)="eliminarTituloDescripcion($index)">ğŸ—‘ï¸ Eliminar</button>
								</div>
							</div>
						}
					</div>
				}

				<div class="d-flex gap-2">
					<button type="submit" class="btn btn-success flex-grow-1">ğŸ’¾ Guardar</button>
					<button type="button" class="btn btn-outline-secondary flex-grow-1" (click)="cancelarEdicionNosotros()">âŒ Cancelar</button>
				</div>
			</form>
		} @else {
			<p class="text-muted text-center py-3">No hay informaciÃ³n. Edita para comenzar.</p>
			<button type="button" class="btn btn-info w-100" (click)="editarNosotros()">ğŸ“ Crear InformaciÃ³n</button>
		}
	</div>

	<div class="row" role="main" aria-label="Panel administrativo">
		<!-- COLUMNA FORMULARIO PRODUCTOS -->
		<div class="col-md-5 mb-4">
			<section class="card shadow border-0 p-4" role="form" aria-labelledby="form-heading">
				<h2 id="form-heading" [ngClass]="editandoId ? 'text-warning' : 'text-success'" class="h4">
					{{ editandoId ? 'ğŸ”§ Editando Producto' : 'â• Agregar Nuevo' }}
				</h2>
				<form (ngSubmit)="manejarEnvio()" class="mt-3" aria-label="Formulario de producto">
					<div class="mb-2">
						<label for="nombre" class="small fw-bold">Nombre del Producto</label>
						<input id="nombre" type="text" class="form-control" [(ngModel)]="formulario.nombre" name="nombre" required aria-required="true" />
					</div>
					<div class="mb-2">
						<label for="precio" class="small fw-bold">Precio ($)</label>
						<input id="precio" type="number" class="form-control" [(ngModel)]="formulario.precio" name="precio" required aria-required="true" />
					</div>
					<div class="mb-2">
						<label for="descripcion-producto" class="small fw-bold">DescripciÃ³n</label>
						<textarea id="descripcion-producto" class="form-control" [(ngModel)]="formulario.descripcion" name="descripcion" required aria-required="true"></textarea>
					</div>
					<div class="mb-3">
						<label for="imagen-producto" class="small fw-bold">URL de Imagen</label>
						<input id="imagen-producto" type="text" class="form-control" placeholder="https://link-de-la-foto.jpg" [(ngModel)]="formulario.imagen" name="imagen" />
					</div>

					<button type="submit" [ngClass]="editandoId ? 'btn-warning' : 'btn-success'" class="btn w-100 fw-bold" [attr.aria-label]="editandoId ? 'Guardar cambios del producto' : 'Publicar nuevo producto'">
						{{ editandoId ? 'Guardar Cambios' : 'Publicar Producto' }}
					</button>

					@if (editandoId) {
						<button type="button" class="btn btn-outline-secondary w-100 mt-2" (click)="cancelarEdicion()" aria-label="Cancelar ediciÃ³n del producto">
							Cancelar EdiciÃ³n
						</button>
					}
				</form>
			</section>
		</div>

		<!-- COLUMNA TABLA PRODUCTOS -->
		<div class="col-md-7">
			<section class="card shadow border-0 p-4" role="region" aria-labelledby="inventory-heading">
				<h2 id="inventory-heading" class="h4 mb-3">ğŸ“¦ Inventario Actual</h2>
				
				@if (cargando) {
					<div class="text-center py-4" role="status" aria-live="polite">
						<div class="spinner-border text-primary" role="status">
							<span class="visually-hidden">Cargando...</span>
						</div>
						<p class="text-muted mt-2">Cargando productos...</p>
					</div>
				} @else if (productos.length === 0) {
					<p class="text-muted text-center py-4" role="status">No hay productos. Â¡Crea uno nuevo!</p>
				} @else {
					<div class="row g-3">
						@for (p of productos; track p.id) {
							<div class="col-12">
								<div class="card border shadow-sm product-card">
									<div class="card-body p-3">
										<div class="row align-items-center">
											<div class="col-auto">
												<img [src]="p.imagen || 'https://via.placeholder.com/80'" 
													 [alt]="'Imagen de ' + p.nombre" 
													 class="rounded product-thumb-lg"
													 style="width: 80px; height: 80px; object-fit: cover;" 
													 onerror="this.src='https://via.placeholder.com/80'" />
											</div>
											<div class="col">
												<h5 class="card-title fw-bold mb-1">{{p.nombre}}</h5>
												<p class="text-muted small mb-2">{{p.descripcion.substring(0, 100)}}...</p>
												<div class="d-flex gap-2 align-items-center">
													<span class="badge bg-success fs-6">${{p.precio}}</span>
													<span class="badge bg-info small">ID: {{p.id}}</span>
												</div>
											</div>
											<div class="col-auto">
												<div class="btn-group" role="group">
													<button type="button" 
															class="btn btn-sm btn-outline-primary" 
															(click)="prepararEdicion(p)" 
															[attr.aria-label]="'Editar producto ' + p.nombre"
															title="Editar">
														âœï¸ Editar
													</button>
													<button type="button" 
															class="btn btn-sm btn-outline-danger" 
															(click)="eliminarProducto(p.id)" 
															[attr.aria-label]="'Eliminar producto ' + p.nombre"
															title="Eliminar">
														ğŸ—‘ï¸ Eliminar
													</button>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						}
					</div>
				}
			</section>
		</div>
	</div>

	<!-- SECCIÃ“N SERVICIOS -->
	<div class="card shadow border-0 p-4 mt-5 bg-light">
		<h2 class="h4 text-primary mb-3">âš™ï¸ Gestionar Servicios</h2>
		
		@if (!editandoServicios && servicios && servicios.length > 0) {
			<div class="alert alert-info">
				<strong>Servicios Actuales:</strong>
				<div class="row g-3 mt-3">
					@for (servicio of servicios; track $index) {
						<div class="col-md-6">
							<div class="card border">
								<div class="card-body">
									<div class="d-flex align-items-start justify-content-between">
										<div>
											<h6 class="card-title fw-bold">{{ servicio.title }}</h6>
											<p class="text-muted small mb-2">{{ servicio.desc }}</p>
											@if (servicio.badge) {
												<span class="badge bg-secondary">{{ servicio.badge }}</span>
											}
										</div>
										<div class="btn-group btn-group-sm">
											<button type="button" class="btn btn-outline-primary" (click)="editarServicio($index)">âœï¸</button>
											<button type="button" class="btn btn-outline-danger" (click)="eliminarServicio($index)">ğŸ—‘ï¸</button>
										</div>
									</div>
								</div>
							</div>
						</div>
					}
				</div>
			</div>
			<button type="button" class="btn btn-warning me-2" (click)="iniciarEdicionServicios()">âœï¸ Editar Servicios</button>
			<button type="button" class="btn btn-success" (click)="iniciarEdicionServicios(); formularioServicio = { icon: '', title: '', desc: '', badge: '' }">â• Agregar Servicio</button>
		} @else if (editandoServicios) {
			<!-- FORMULARIO DE EDICIÃ“N -->
			<form (ngSubmit)="guardarServicio()" class="mt-3 card bg-white p-4">
				<div class="mb-3">
					<label for="servicio-icon" class="form-label fw-bold">Ãcono (Bootstrap Icons)</label>
					<input id="servicio-icon" type="text" class="form-control" placeholder="bi-wrench" [(ngModel)]="formularioServicio.icon" name="icon" />
					<small class="text-muted">Ej: bi-wrench, bi-truck, bi-shield-check</small>
				</div>

				<div class="mb-3">
					<label for="servicio-title" class="form-label fw-bold">TÃ­tulo del Servicio</label>
					<input id="servicio-title" type="text" class="form-control" placeholder="Soporte TÃ©cnico" [(ngModel)]="formularioServicio.title" name="title" required />
				</div>

				<div class="mb-3">
					<label for="servicio-desc" class="form-label fw-bold">DescripciÃ³n</label>
					<textarea id="servicio-desc" class="form-control" placeholder="DescripciÃ³n del servicio" [(ngModel)]="formularioServicio.desc" name="desc" required></textarea>
				</div>

				<div class="mb-3">
					<label for="servicio-badge" class="form-label fw-bold">Etiqueta (Badge)</label>
					<input id="servicio-badge" type="text" class="form-control" placeholder="24/7, Express, etc" [(ngModel)]="formularioServicio.badge" name="badge" />
				</div>

				<div class="d-flex gap-2">
					<button type="submit" class="btn btn-success flex-grow-1">ğŸ’¾ {{ editandoServicioIndex !== null ? 'Guardar Cambios' : 'Agregar Servicio' }}</button>
					<button type="button" class="btn btn-outline-secondary flex-grow-1" (click)="cancelarEdicionServicios()">âŒ Cancelar</button>
				</div>
			</form>
		} @else {
			<p class="text-muted">No hay servicios. Crea uno nuevo.</p>
			<button type="button" class="btn btn-success" (click)="iniciarEdicionServicios()">â• Crear Servicio</button>
		}
	</div>
</div>
