<div class="container py-5">
	<h1 class="text-center mb-4">Panel de Control - Tech Store Pro</h1>

	<!-- SECCI√ìN NOSOTROS -->
	<div class="card shadow border-0 p-4 mb-5 bg-light">
		<h2 class="h4 text-primary mb-3">üìñ Gestionar Secci√≥n "Nosotros"</h2>
		
		@if (cargandoNosotros) {
			<div class="text-center py-3">
				<div class="spinner-border spinner-border-sm text-primary" role="status">
					<span class="visually-hidden">Cargando...</span>
				</div>
				<p class="text-muted mt-2 small">Cargando informaci√≥n...</p>
			</div>
		} @else if (!editandoNosotros && nosotros && nosotros.titulos_descripciones && nosotros.titulos_descripciones.length > 0) {
			<div class="alert alert-info">
				<strong>Imagen:</strong> <img [src]="nosotros.imagen" style="max-height: 80px; border-radius: 3px; margin: 5px 0;" [alt]="'Imagen de nosotros'" onerror="this.style.display='none'" />
				<div class="mt-3">
					<strong>T√≠tulos y Descripciones:</strong>
					<ul class="mt-2">
						@for (item of nosotros.titulos_descripciones; track $index) {
							<li class="mb-3 p-2 bg-white rounded border">
								<strong>{{ item.titulo }}</strong>
								<p class="text-muted mb-0 small">{{ item.descripcion.substring(0, 100) }}...</p>
							</li>
						}
					</ul>
				</div>
			</div>
			<button type="button" class="btn btn-warning" (click)="editarNosotros()">‚úèÔ∏è Editar</button>
		} @else if (editandoNosotros && nosotros) {
			<!-- FORMULARIO DE EDICI√ìN -->
			<form (ngSubmit)="guardarNosotros()" class="mt-3">
				<div class="mb-3">
					<label for="imagen-nosotros" class="form-label fw-bold">URL de Imagen (Una sola para toda la secci√≥n)</label>
					<input id="imagen-nosotros" type="text" class="form-control" placeholder="https://..." [(ngModel)]="formularioNosotros.imagen" name="imagen" required aria-required="true" />
					@if (formularioNosotros.imagen) {
						<div class="mt-2">
							<small class="text-muted">Previsualizaci√≥n:</small>
							<img [src]="formularioNosotros.imagen" style="max-height: 150px; border-radius: 5px; margin-top: 5px;" alt="Preview" onerror="this.style.display='none'" />
						</div>
					}
				</div>

				<hr />

				<h5 class="text-secondary">Agregar T√≠tulos y Descripciones</h5>
				
				<div class="mb-3">
					<label for="titulo-input" class="form-label fw-bold">T√≠tulo</label>
					<input id="titulo-input" type="text" class="form-control" [(ngModel)]="formularioNosotros.titulo_temp" name="titulo_temp" placeholder="Ej: Nuestra Misi√≥n" />
				</div>

				<div class="mb-3">
					<label for="descripcion-input" class="form-label fw-bold">Descripci√≥n</label>
					<textarea id="descripcion-input" class="form-control" [(ngModel)]="formularioNosotros.descripcion_temp" name="descripcion_temp" placeholder="Escribe la descripci√≥n aqu√≠..." rows="4"></textarea>
				</div>

				<button type="button" class="btn btn-info mb-3" (click)="agregarTituloDescripcion()">‚ûï Agregar T√≠tulo/Descripci√≥n</button>

				@if (nosotros.titulos_descripciones && nosotros.titulos_descripciones.length > 0) {
					<div class="list-group mb-3">
						@for (item of nosotros.titulos_descripciones; track $index) {
							<div class="list-group-item d-flex justify-content-between align-items-start">
								<div class="flex-grow-1">
									<h6 class="mb-1">{{ item.titulo }}</h6>
									<p class="mb-0 text-muted small">{{ item.descripcion.substring(0, 80) }}...</p>
								</div>
								<div class="btn-group ms-2">
									<button type="button" class="btn btn-sm btn-outline-primary" (click)="prepararEdicionTituloDescripcion($index)">‚úèÔ∏è Editar</button>
									<button type="button" class="btn btn-sm btn-outline-danger" (click)="eliminarTituloDescripcion($index)">üóëÔ∏è Eliminar</button>
								</div>
							</div>
						}
					</div>
				}

				<div class="d-flex gap-2">
					<button type="submit" class="btn btn-success flex-grow-1">üíæ Guardar</button>
					<button type="button" class="btn btn-outline-secondary flex-grow-1" (click)="cancelarEdicionNosotros()">‚ùå Cancelar</button>
				</div>
			</form>
		} @else {
			<p class="text-muted text-center py-3">No hay informaci√≥n. Edita para comenzar.</p>
			<button type="button" class="btn btn-info w-100" (click)="editarNosotros()">üìù Crear Informaci√≥n</button>
		}
	</div>

	<div class="row" role="main" aria-label="Panel administrativo">
		<!-- COLUMNA FORMULARIO PRODUCTOS -->
		<div class="col-md-5 mb-4">
			<section class="card shadow border-0 p-4" role="form" aria-labelledby="form-heading">
				<h2 id="form-heading" [ngClass]="editandoId ? 'text-warning' : 'text-success'" class="h4">
					{{ editandoId ? 'üîß Editando Producto' : '‚ûï Agregar Nuevo' }}
				</h2>
				<form (ngSubmit)="manejarEnvio()" class="mt-3" aria-label="Formulario de producto">
					<div class="mb-2">
						<label for="nombre" class="small fw-bold">Nombre del Producto</label>
						<input id="nombre" type="text" class="form-control" [(ngModel)]="formulario.nombre" name="nombre" required aria-required="true" />
					</div>
					<div class="mb-2">
						<label for="precio" class="small fw-bold">Precio ($)</label>
						<input id="precio" type="number" class="form-control" [(ngModel)]="formulario.precio" name="precio" required aria-required="true" />
					</div>
					<div class="mb-2">
						<label for="descripcion-producto" class="small fw-bold">Descripci√≥n</label>
						<textarea id="descripcion-producto" class="form-control" [(ngModel)]="formulario.descripcion" name="descripcion" required aria-required="true"></textarea>
					</div>
					<div class="mb-3">
						<label for="imagen-producto" class="small fw-bold">URL de Imagen</label>
						<input id="imagen-producto" type="text" class="form-control" placeholder="https://link-de-la-foto.jpg" [(ngModel)]="formulario.imagen" name="imagen" />
					</div>

					<button type="submit" [ngClass]="editandoId ? 'btn-warning' : 'btn-success'" class="btn w-100 fw-bold" [attr.aria-label]="editandoId ? 'Guardar cambios del producto' : 'Publicar nuevo producto'">
						{{ editandoId ? 'Guardar Cambios' : 'Publicar Producto' }}
					</button>

					@if (editandoId) {
						<button type="button" class="btn btn-outline-secondary w-100 mt-2" (click)="cancelarEdicion()" aria-label="Cancelar edici√≥n del producto">
							Cancelar Edici√≥n
						</button>
					}
				</form>
			</section>
		</div>

		<!-- COLUMNA TABLA PRODUCTOS -->
		<div class="col-md-7">
			<section class="card shadow border-0 p-4" role="region" aria-labelledby="inventory-heading">
				<h2 id="inventory-heading" class="h4">Inventario Actual</h2>
				<div class="table-responsive mt-3">
					<table class="table table-hover align-middle" aria-label="Tabla de productos">
						<thead class="table-light">
							<tr>
								<th>Imagen</th>
								<th>Producto</th>
								<th>Acciones</th>
							</tr>
						</thead>
						<tbody>
							@for (p of productos; track p.id) {
								<tr>
									<td>
										<img [src]="p.imagen || 'https://via.placeholder.com/50'" [alt]="'Imagen miniatura de ' + p.nombre" class="rounded product-thumb" />
									</td>
									<td>
										<div class="fw-bold">{{p.nombre}}</div>
										<div class="text-muted small" aria-label="Precio: {{p.precio}} d√≥lares">${{p.precio}}</div>
									</td>
									<td>
										<button class="btn btn-sm btn-outline-primary me-2" (click)="prepararEdicion(p)" [attr.aria-label]="'Editar producto ' + p.nombre">
											Editar
										</button>
										<button class="btn btn-sm btn-outline-danger" (click)="eliminarProducto(p.id)" [attr.aria-label]="'Eliminar producto ' + p.nombre">
											Eliminar
										</button>
									</td>
								</tr>
							}
						</tbody>
					</table>
					@if (cargando) {
						<div class="text-center py-4" role="status" aria-live="polite">
							<div class="spinner-border text-primary" role="status">
								<span class="visually-hidden">Cargando...</span>
							</div>
							<p class="text-muted mt-2">Cargando productos...</p>
						</div>
					} @else if (productos.length === 0) {
						<p class="text-muted text-center py-3" role="status">No hay productos. ¬°Crea uno nuevo!</p>
					}
				</div>
			</section>
		</div>
	</div>
</div>
