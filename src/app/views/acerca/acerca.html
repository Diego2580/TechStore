<div class="container py-5">
  
  <section class="mb-5 fade-in">
    <div class="text-center mb-5">
      <span class="badge bg-primary bg-opacity-10 text-light px-3 py-2 rounded-pill mb-3">Nuestra Historia</span>
      <h1 class="display-4 fw-bold mb-3 text-light">Innovando desde el Coraz√≥n de Cuenca</h1>
      <p class="lead text-light mx-auto opacity-75" style="max-width: 800px;">
        Conoce c√≥mo pasamos de ser un peque√±o proyecto universitario a convertirnos en el referente tecnol√≥gico del Austro ecuatoriano.
      </p>
      
      <!-- Bot√≥n de editar solo para admin -->
      @if (authService.isAuthenticated() && !editando) {
        <div class="mt-3">
          <button type="button" class="btn btn-warning btn-sm" (click)="iniciarEdicion()">
            ‚úèÔ∏è Editar Informaci√≥n
          </button>
        </div>
      }
    </div>

    @if (!editando) {
      <!-- VISTA NORMAL -->
      <div class="row align-items-center g-5 mb-5">
        <div class="col-lg-6">
          <div class="p-4 bg-secondary rounded-4 border border-light shadow-sm h-100">
            <h2 class="h4 fw-bold text-light mb-4">¬øQui√©nes Somos?</h2>
            <p class="text-light mb-3 opacity-85">
              TechStore Pro naci√≥ en 2024 como una respuesta a la creciente demanda de componentes de alto rendimiento en Ecuador. Fundada por un grupo de entusiastas del hardware y desarrolladores de software, nuestra misi√≥n siempre ha sido clara: <strong>democratizar el acceso a la tecnolog√≠a de punta.</strong>
            </p>
            <p class="text-light opacity-85">
              Entendemos que una computadora no es solo una m√°quina; es la herramienta con la que se construye el futuro. Ya seas un arquitecto renderizando planos, un desarrollador compilando c√≥digo complejo o un gamer buscando la m√°xima tasa de cuadros, estamos aqu√≠ para asegurarnos de que tu hardware nunca sea un l√≠mite.
            </p>
          </div>
        </div>
        <div class="col-lg-6">
          <div class="row g-3">
            <div class="col-6">
              <div class="p-3 bg-secondary rounded-3 text-center border border-light h-100 d-flex flex-column justify-content-center">
                <div class="display-4 fw-bold text-light mb-0">2024</div>
                <small class="text-light fw-bold text-uppercase opacity-75">A√±o de Fundaci√≥n</small>
              </div>
            </div>
            <div class="col-6">
              <div class="p-3 bg-secondary rounded-3 text-center border border-light h-100 d-flex flex-column justify-content-center">
                <div class="display-4 fw-bold text-light mb-0">Cuenca</div>
                <small class="text-light fw-bold text-uppercase opacity-75">Sede Principal</small>
              </div>
            </div>
            <div class="col-12">
              <div class="p-4 bg-primary text-white rounded-3 text-center shadow-sm">
                <i class="bi bi-quote fs-1 opacity-50"></i>
                <p class="fs-5 fst-italic mb-0">"La tecnolog√≠a es mejor cuando une a las personas."</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    } @else {
      <!-- FORMULARIO DE EDICI√ìN -->
      <form (ngSubmit)="guardarNosotros()" class="card bg-light p-4 mb-4">
        <h4 class="mb-3 text-primary">‚úèÔ∏è Editar Informaci√≥n de la Empresa</h4>
        
        <div class="mb-3">
          <label for="imagen-url" class="form-label fw-bold">URL de Imagen</label>
          <input id="imagen-url" type="text" class="form-control" placeholder="https://..." [(ngModel)]="formularioNosotros.imagen" name="imagen" />
        </div>

        <div class="mb-3">
          <label for="imagen-file" class="form-label fw-bold">O Cargar Imagen</label>
          <input id="imagen-file" type="file" class="form-control" accept="image/*" (change)="onImageSelected($event)" />
          <small class="text-muted">M√°x. 5MB</small>
        </div>

        @if (formularioNosotros.imagen) {
          <div class="mb-3">
            <small class="text-muted"><strong>Previsualizaci√≥n:</strong></small>
            <img [src]="formularioNosotros.imagen" 
                 style="max-height: 150px; border-radius: 5px; margin-top: 8px;" 
                 alt="Preview" 
                 onerror="this.style.display='none'" 
                 class="img-thumbnail" />
          </div>
        }

        <hr />

        <h5 class="mb-3">T√≠tulos y Descripciones</h5>

        <div class="row mb-3">
          <div class="col-md-6">
            <input type="text" class="form-control" placeholder="T√≠tulo" [(ngModel)]="formularioNosotros.titulo_temp" name="titulo_temp" />
          </div>
          <div class="col-md-6">
            <textarea class="form-control" placeholder="Descripci√≥n" [(ngModel)]="formularioNosotros.descripcion_temp" name="descripcion_temp" rows="2"></textarea>
          </div>
        </div>

        <button type="button" class="btn btn-info btn-sm mb-3" (click)="agregarTituloDescripcion()">
          ‚ûï Agregar
        </button>

        @if (nosotros?.titulos_descripciones && nosotros.titulos_descripciones.length > 0) {
          <div class="list-group mb-3">
            @for (item of nosotros.titulos_descripciones; track $index) {
              <div class="list-group-item d-flex justify-content-between align-items-start">
                <div>
                  <h6 class="mb-1">{{ item.titulo }}</h6>
                  <p class="mb-0 small text-muted">{{ item.descripcion.substring(0, 80) }}...</p>
                </div>
                <div class="btn-group btn-group-sm">
                  <button type="button" class="btn btn-outline-primary" (click)="prepararEdicionTituloDescripcion($index)">‚úèÔ∏è</button>
                  <button type="button" class="btn btn-outline-danger" (click)="eliminarTituloDescripcion($index)">üóëÔ∏è</button>
                </div>
              </div>
            }
          </div>
        }

        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-success flex-grow-1">üíæ Guardar</button>
          <button type="button" class="btn btn-outline-secondary flex-grow-1" (click)="cancelarEdicion()">‚ùå Cancelar</button>
        </div>
      </form>
    }
  </section>

  <section aria-label="Informaci√≥n adicional de la empresa">
    @if (cargando) {
      <div class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Cargando informaci√≥n...</span>
        </div>
        <p class="text-light mt-3 opacity-75">Sincronizando con nuestros servidores...</p>
      </div>
    } @else if (nosotros) {
      <article class="fade-in">
        <div class="row align-items-center mb-5">
          <div class="col-md-6 mb-4 mb-md-0">
            <img [src]="nosotros.imagen" 
                 alt="Instalaciones de TechStore" 
                 class="img-fluid rounded-4 shadow"
                 style="object-fit: cover; width: 100%; height: 400px;" 
                 onerror="this.src='https://images.unsplash.com/photo-1531297461136-8208b501ad4d?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80'"/>
          </div>
          <div class="col-md-6">
            @for (item of nosotros.titulos_descripciones; track $index) {
              <div class="mb-4 p-3 rounded-3 bg-secondary border border-light">
                <h3 class="fw-bold mb-2 text-light d-flex align-items-center justify-content-between">
                  <span>
                    <i class="bi bi-check-circle-fill me-2 fs-5 text-primary"></i>
                    {{ item.titulo }}
                  </span>
                  @if (authService.isAuthenticated() && editando) {
                    <div class="btn-group btn-group-sm">
                      <button type="button" class="btn btn-outline-primary" (click)="prepararEdicionTituloDescripcion($index)">‚úèÔ∏è</button>
                      <button type="button" class="btn btn-outline-danger" (click)="eliminarTituloDescripcion($index)">üóëÔ∏è</button>
                    </div>
                  }
                </h3>
                <p class="text-light mb-0 ps-4 border-start border-2 border-primary ms-2 opacity-85">
                  {{ item.descripcion }}
                </p>
              </div>
            }
          </div>
        </div>
      </article>
    } @else {
      <div class="alert alert-secondary border border-light shadow-sm d-flex align-items-center p-4 rounded-4" role="alert">
        <i class="bi bi-info-circle-fill text-light fs-3 me-3"></i>
        <div>
          <h4 class="alert-heading h6 fw-bold mb-1 text-light">Actualizaci√≥n en curso</h4>
          <p class="mb-0 text-light small opacity-75">Estamos actualizando nuestros valores corporativos din√°micos. La historia de arriba sigue vigente.</p>
        </div>
      </div>
    }
  </section>
</div>