<div class="container py-5">
  <section class="mb-5 fade-in">
    @if (!editando) {
      <!-- VISTA NORMAL - SOLO CONTENIDO DEL BACKEND -->
      <div class="mb-3">
        @if (authService.isAuthenticated()) {
          <button type="button" class="btn btn-warning btn-sm" (click)="iniciarEdicion()">
            ‚úèÔ∏è Editar Informaci√≥n
          </button>
        }
      </div>

      @if (cargando) {
        <div class="text-center py-5">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Cargando informaci√≥n...</span>
          </div>
          <p class="text-light mt-3 opacity-75">Cargando informaci√≥n...</p>
        </div>
      } @else if (nosotros) {
        <article class="fade-in">
          <div class="row align-items-center mb-5 g-5">
            <div class="col-md-6 mb-4 mb-md-0">
              <img [src]="nosotros.imagen" 
                   alt="Instalaciones de TechStore" 
                   class="img-fluid rounded-4 shadow"
                   style="object-fit: cover; width: 100%; height: 400px;" 
                   onerror="this.src='https://images.unsplash.com/photo-1531297461136-8208b501ad4d?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80'"/>
            </div>
            <div class="col-md-6">
              @for (item of nosotros.titulos_descripciones; track $index) {
                <div class="mb-4 p-3 rounded-3 bg-secondary border border-light">
                  <h3 class="fw-bold mb-2 text-light d-flex align-items-center">
                    <i class="bi bi-check-circle-fill me-2 fs-5 text-primary"></i>
                    {{ item.titulo }}
                  </h3>
                  <p class="text-light mb-0 ps-4 border-start border-2 border-primary ms-2 opacity-85">
                    {{ item.descripcion }}
                  </p>
                </div>
              }
            </div>
          </div>
        </article>
      } @else if (error) {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
          <strong>Error:</strong> {{ error }}
        </div>
      }
    } @else {
      <!-- FORMULARIO DE EDICI√ìN -->
      <form (ngSubmit)="guardarNosotros()" class="card bg-light p-4 mb-4">
        <h4 class="mb-3 text-primary">‚úèÔ∏è Editar Informaci√≥n de la Empresa</h4>
        
        <div class="mb-3">
          <label for="imagen-url" class="form-label fw-bold">URL de Imagen</label>
          <input id="imagen-url" type="text" class="form-control" placeholder="https://..." [(ngModel)]="formularioNosotros.imagen" name="imagen" />
        </div>

        <div class="mb-3">
          <label for="imagen-file" class="form-label fw-bold">O Cargar Imagen</label>
          <input id="imagen-file" type="file" class="form-control" accept="image/*" (change)="onImageSelected($event)" />
          <small class="text-muted">M√°x. 5MB</small>
        </div>

        @if (formularioNosotros.imagen) {
          <div class="mb-3">
            <small class="text-muted"><strong>Previsualizaci√≥n:</strong></small>
            <img [src]="formularioNosotros.imagen" 
                 style="max-height: 150px; border-radius: 5px; margin-top: 8px;" 
                 alt="Preview" 
                 onerror="this.style.display='none'" 
                 class="img-thumbnail" />
          </div>
        }

        <hr />

        <h5 class="mb-3">T√≠tulos y Descripciones</h5>

        <div class="row mb-3">
          <div class="col-md-6">
            <input type="text" class="form-control" placeholder="T√≠tulo" [(ngModel)]="formularioNosotros.titulo_temp" name="titulo_temp" />
          </div>
          <div class="col-md-6">
            <textarea class="form-control" placeholder="Descripci√≥n" [(ngModel)]="formularioNosotros.descripcion_temp" name="descripcion_temp" rows="2"></textarea>
          </div>
        </div>

        <button type="button" class="btn btn-info btn-sm mb-3" (click)="agregarTituloDescripcion()">
          ‚ûï Agregar
        </button>

        @if (nosotros?.titulos_descripciones && nosotros.titulos_descripciones.length > 0) {
          <div class="list-group mb-3">
            @for (item of nosotros.titulos_descripciones; track $index) {
              <div class="list-group-item d-flex justify-content-between align-items-start">
                <div>
                  <h6 class="mb-1">{{ item.titulo }}</h6>
                  <p class="mb-0 small text-muted">{{ item.descripcion.substring(0, 80) }}...</p>
                </div>
                <div class="btn-group btn-group-sm">
                  <button type="button" class="btn btn-outline-primary" (click)="prepararEdicionTituloDescripcion($index)">‚úèÔ∏è</button>
                  <button type="button" class="btn btn-outline-danger" (click)="eliminarTituloDescripcion($index)">üóëÔ∏è</button>
                </div>
              </div>
            }
          </div>
        }

        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-success flex-grow-1">üíæ Guardar</button>
          <button type="button" class="btn btn-outline-secondary flex-grow-1" (click)="cancelarEdicion()">‚ùå Cancelar</button>
        </div>
      </form>
    }
  </section>
</div>